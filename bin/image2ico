#!/bin/bash
# image2ico - Convert image to ICO format
#
# Converts any image to Windows ICO format with multiple sizes
# (256, 128, 64, 48, 32, 16). Best results with square images.
# Note: ICO format limits max size to 256x256.
#
# Usage:
#   image2ico <image> [outname]
#
# Examples:
#   image2ico logo.png            # creates logo.ico
#   image2ico icon.webp favicon   # creates favicon.ico
#   image2ico ~/img/app.png       # creates ~/img/app.ico

[[ "$1" == "--describe" ]] && echo "Convert image to Windows ICO format" && exit 0

if [[ "$1" == "--help" ]]; then
    echo "Usage: image2ico <image> [outname]"
    echo ""
    echo "Convert image to Windows ICO format."
    echo "  image     Input image file (square recommended)"
    echo "  outname   Output filename (default: input name)"
    echo ""
    echo "Creates multi-size ICO: 256, 128, 64, 48, 32, 16px"
    echo "Note: ICO max size is 256x256"
    exit 0
fi

if [[ -z "$1" ]]; then
    echo "Usage: image2ico <image> [outname]"
    exit 1
fi

img="$1"
out="${img}"
out="${2:-$out}"
out="${out%.*}.ico"
out="$(dirname "$img")/$(basename "$out")"

magick "$img" -define icon:auto-resize=256,128,64,48,32,16 "$out"

echo "$out"
