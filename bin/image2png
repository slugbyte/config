#!/bin/bash
# $ image2png $image-filepath [outname]
# outfile fill be in same directory as the input filepath
# it will error if the output filepath allready exists
# outfile will allways have the extension .png
img="$1"
out="${img}"
out="${2:-$out}"
out="${out%.*}.png"
out="$(dirname "$img")/$(basename "$out")"

if [[ -f $out ]];then
  echo "ERROR: output path allready exists $out"
  exit 1
fi

magick "$img" -strip -define png:compression-filter=5 \
  -define png:compression-level=9 \
  -define png:compression-strategy=1 \
  -define png:exclude-chunk=all \
  "${out}"

echo "$out"
